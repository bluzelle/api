
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="images/favicon.ico" rel="icon" type="image/ico" />
    
    <title>Bluzelle API Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#crud-application" class="toc-h2 toc-link" data-title="crud-application">CRUD Application</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#js-api" class="toc-h1 toc-link" data-title="js-api">JS API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#installation" class="toc-h2 toc-link" data-title="installation">Installation</a>
                  </li>
                  <li>
                    <a href="#sample-application" class="toc-h2 toc-link" data-title="sample-application">Sample Application</a>
                  </li>
                  <li>
                    <a href="#connect-ws-uuid" class="toc-h2 toc-link" data-title="connect-ws-uuid">connect(ws, uuid)</a>
                  </li>
                  <li>
                    <a href="#create-key-value" class="toc-h2 toc-link" data-title="create-key-value">create(key, value)</a>
                  </li>
                  <li>
                    <a href="#read-key" class="toc-h2 toc-link" data-title="read-key">read(key)</a>
                  </li>
                  <li>
                    <a href="#update-key-value" class="toc-h2 toc-link" data-title="update-key-value">update(key, value)</a>
                  </li>
                  <li>
                    <a href="#remove-key" class="toc-h2 toc-link" data-title="remove-key">remove(key)</a>
                  </li>
                  <li>
                    <a href="#has-key" class="toc-h2 toc-link" data-title="has-key">has(key)</a>
                  </li>
                  <li>
                    <a href="#keys" class="toc-h2 toc-link" data-title="keys">keys()</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#python-api" class="toc-h1 toc-link" data-title="python-api">Python API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#installation-2" class="toc-h2 toc-link" data-title="installation">Installation</a>
                  </li>
                  <li>
                    <a href="#connect-host-port-uuid" class="toc-h2 toc-link" data-title="connect-host-port-uuid">connect(host, port, uuid)</a>
                  </li>
                  <li>
                    <a href="#create-key-value-2" class="toc-h2 toc-link" data-title="create-key-value">create(key, value)</a>
                  </li>
                  <li>
                    <a href="#read-key-2" class="toc-h2 toc-link" data-title="read-key">read(key)</a>
                  </li>
                  <li>
                    <a href="#update-key-value-2" class="toc-h2 toc-link" data-title="update-key-value">update(key, value)</a>
                  </li>
                  <li>
                    <a href="#delete-key" class="toc-h2 toc-link" data-title="delete-key">delete(key)</a>
                  </li>
                  <li>
                    <a href="#has-key-2" class="toc-h2 toc-link" data-title="has-key">has(key)</a>
                  </li>
                  <li>
                    <a href="#keys-2" class="toc-h2 toc-link" data-title="keys">keys()</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#solidity-api" class="toc-h1 toc-link" data-title="solidity-api">Solidity API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#importing" class="toc-h2 toc-link" data-title="importing">Importing</a>
                  </li>
                  <li>
                    <a href="#usage" class="toc-h2 toc-link" data-title="usage">Usage</a>
                  </li>
                  <li>
                    <a href="#caveats" class="toc-h2 toc-link" data-title="caveats">Caveats</a>
                  </li>
                  <li>
                    <a href="#sample-application-2" class="toc-h2 toc-link" data-title="sample-application">Sample Application</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#websocket-api" class="toc-h1 toc-link" data-title="websocket-api">WebSocket API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#steps-to-send-a-request-and-recieve-a-response" class="toc-h2 toc-link" data-title="steps-to-send-a-request-and-recieve-a-response">Steps to send a request and recieve a response</a>
                  </li>
                  <li>
                    <a href="#example-messages-with-bluzelle-js" class="toc-h2 toc-link" data-title="example-messages-with-code-bluzelle-js-code">Example messages with <code>bluzelle-js</code></a>
                  </li>
              </ul>
          </li>
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Bluzelle combines the sharing economy with the token economy - renting individuals&#39; computer storage space to earn tokens while dApp developers use tokens to have their dApp&#39;s data stored and managed.</p>

<p>This guide covers API for our JavaScript &amp; Python libraries, Solidity contracts, and raw WebSocket communications.</p>
<h2 id='crud-application'>CRUD Application</h2>
<p>Bluzelle comes with a CRUD (Create, Read, Update, Delete, etc.) application that is built with the Bluzelle libraries. </p>

<p>You can find binaries in our <a href="https://bluzelle.jfrog.io/bluzelle/list/OSX/">OSX</a> and <a href="https://bluzelle.jfrog.io/bluzelle/list/debian-local/">Debian</a> repositories, or build the project yourself from the <a href="https://github.com/bluzelle/crud">GitHub repository</a>.</p>
<h1 id='js-api'>JS API</h1><h2 id='installation'>Installation</h2>
<blockquote>
<p>Our client JavaScript library can be installed through <code>npm</code>.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">bluzelle</span>
</code></pre>
<blockquote>
<p>You import <em>Bluzelle</em> into your application the same as any other library.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">bluzelle</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bluzelle'</span><span class="p">);</span>
</code></pre>
<p>This portion of the documentation covers our <strong>JavaScript</strong> tools. Each function in the JavaScript API wraps a request-response pair in the WebSocket API.</p>

<p>See also our <a href="https://github.com/bluzelle/bluzelle-js">repository</a> on GitHub.</p>
<h2 id='sample-application'>Sample Application</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">bluzelle</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bluzelle'</span><span class="p">);</span>

<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'ws://testnet.bluzelle.com:51010'</span><span class="p">,</span> <span class="s1">'45498479-2447-47a6-8c36-efa5d251a283'</span><span class="p">);</span>


<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'myKey'</span><span class="p">,</span> <span class="s1">'myValue'</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="s1">'myKey'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// 'myValue'</span>

    <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>

<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
</code></pre>
<p>The Bluzelle JavaScript library works with promises to model asynchronous behavior. Ensure that dependent calls to the Bluzelle database are within <code>.then()</code> calls as in the sample application to the right. Also ensure that promises errors are caught and handled.</p>

<p>You can also program using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">ES6 async/await syntax</a> to avoid excessive use of <code>.then()</code>.</p>

<hr>
<h2 id='connect-ws-uuid'>connect(ws, uuid)</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">bluzelle</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'ws://1.2.3.4:51010'</span><span class="p">,</span> <span class="s1">'96764e2f-2273-4404-97c0-a05b5e36ea66'</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">b</span> <span class="o">=</span> <span class="n">pyBluzelle</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">51011</span><span class="p">,</span> <span class="s">"137a8403-52ec-43b7-8083-91391d4c5e67"</span><span class="p">)</span>
</code></pre>
<p>Configures the address, port, and UUID of the connection. This may be called multiple times, and between other API calls.</p>

<p><em>Bluzelle</em> uses <code>UUID</code>&#39;s to identify distinct databases on a single swarm. We recommend using <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)">Version 4 of the universally unique identifier</a>.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ws</td>
<td>The WebSocket entry point to connect to.</td>
</tr>
<tr>
<td>uuid</td>
<td>The universally unique identifier (UUID), <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)">Version 4 is recommended</a></td>
</tr>
</tbody></table>
<h3 id='returns'>Returns</h3>
<p>Nothing</p>

<aside class="warning">
You must replace <code>UUID</code> with your personal UUID.
</aside>
<h2 id='create-key-value'>create(key, value)</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// promise syntax</span>
<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">,</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">13</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>

<span class="c1">// async/await syntax</span>
<span class="nx">await</span> <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">,</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">13</span> <span class="p">});</span>
</code></pre>
<p>Creates a field. <em>Bluzelle</em> supports JavaScript types that are <code>JSON</code>-serializable (strings, objects, numbers, booleans, arrays, and combinations theereof) and also serial data in the form of an <a href="">ArrayBuffer</a>. Functions are not valid.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key</td>
</tr>
<tr>
<td>value</td>
<td>The value to set the key</td>
</tr>
</tbody></table>
<h3 id='returns-2'>Returns</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> resolving to no value.</p>
<h3 id='fail-conditions'>Fail Conditions</h3>
<p>Fails when a response is not received from the connection or invalid value.</p>
<h2 id='read-key'>read(key)</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// promise syntax</span>
<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>

<span class="c1">// async/await syntax</span>
<span class="kr">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">);</span>
</code></pre>
<p>Retrieve the value of a key.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The key to retrieve.</td>
</tr>
</tbody></table>
<h3 id='returns-3'>Returns</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> resolving the value of the key. This is anything that is valid in the <em>Bluzelle</em> database. (See <a href="#update-key-value"><code>update(key, value)</code></a>)</p>
<h3 id='fail-conditions-2'>Fail Conditions</h3>
<p>Fails when a response is not recieved or the key does not exist in the database.</p>
<h2 id='update-key-value'>update(key, value)</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// promise syntax</span>
<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">,</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">13</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>

<span class="c1">// async/await syntax</span>
<span class="nx">await</span> <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">,</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">13</span> <span class="p">});</span>
</code></pre>
<blockquote>
<p>Serial data example.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>
<span class="kr">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

<span class="c1">// Fill arr with data</span>

<span class="nx">await</span> <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">,</span> <span class="nx">arr</span><span class="p">);</span>
</code></pre>
<p>Update a field in the database.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key to query</td>
</tr>
<tr>
<td>value</td>
<td>The value to set the key</td>
</tr>
</tbody></table>
<h3 id='returns-4'>Returns</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> resolving to nothing.</p>
<h3 id='fail-conditions-3'>Fail Conditions</h3>
<p>Fails when a response is not received from the connection or invalid value.</p>
<h2 id='remove-key'>remove(key)</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// promise syntax</span>
<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>

<span class="c1">// async/await syntax</span>
<span class="nx">await</span> <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">);</span>
</code></pre>
<p>Deletes a field from the database.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key to delete.</td>
</tr>
</tbody></table>
<h3 id='returns-5'>Returns</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> resolving to nothing.</p>
<h3 id='fail-conditions-4'>Fail Conditions</h3>
<p>Fails when a response is not received from the connection or key not in database.</p>
<h2 id='has-key'>has(key)</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// promise syntax</span>
<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">hasMyKey</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>

<span class="c1">// async/await syntax</span>
<span class="kr">const</span> <span class="nx">hasMyKey</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">);</span>
</code></pre>
<p>Query to see if a key is in the database.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key to query</td>
</tr>
</tbody></table>
<h3 id='returns-6'>Returns</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> resolving to a boolean value, <code>true</code> of <code>false</code>, representing whether or not the key is in the database.</p>
<h3 id='fail-conditions-5'>Fail Conditions</h3>
<p>Fails when a response is not received from the connection.</p>
<h2 id='keys'>keys()</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// promise syntax</span>
<span class="nx">bluzelle</span><span class="p">.</span><span class="nx">keys</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">keys</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">});</span>

<span class="c1">// async/await syntax</span>
<span class="kr">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">bluzelle</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
</code></pre>
<p>Retrieve a list of all keys.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
</tbody></table>
<h3 id='returns-7'>Returns</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> resolving to an array of strings representing keys in the database. ex. <code>[&quot;Key1&quot;, &quot;Key2&quot;, ...]</code></p>
<h3 id='fail-conditions-6'>Fail Conditions</h3>
<p>Fails when a response is not received from the connection.</p>

<hr>
<h1 id='python-api'>Python API</h1><h2 id='installation-2'>Installation</h2><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">pyBluzelle</span>
</code></pre>
<p>Please refer to the instructions <a href="https://github.com/bluzelle/pyBluzelle">here</a>.</p>

<hr>
<h2 id='connect-host-port-uuid'>connect(host, port, uuid)</h2><pre class="highlight python tab-python"><code><span class="n">b</span> <span class="o">=</span> <span class="n">pyBluzelle</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span>
    <span class="s">"127.0.0.1"</span><span class="p">,</span> 
    <span class="mi">51011</span><span class="p">,</span> 
    <span class="s">"137a8403-52ec-43b7-8083-91391d4c5e67"</span><span class="p">)</span>
</code></pre>
<p>Configures the address, port, and UUID of the connection.</p>

<p><em>Bluzelle</em> uses <code>UUID</code>&#39;s to identify distinct databases on a single swarm. We recommend using <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)">Version 4 of the universally unique identifier</a>.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>host</td>
<td>The host name of the entry point.</td>
</tr>
<tr>
<td>port</td>
<td>The port of the entry point.</td>
</tr>
<tr>
<td>uuid</td>
<td>The universally unique identifier (UUID), <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)">Version 4 is recommended</a></td>
</tr>
</tbody></table>
<h3 id='returns-8'>Returns</h3>
<p>A connection object.</p>
<h2 id='create-key-value-2'>create(key, value)</h2><pre class="highlight python tab-python"><code><span class="n">b</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">"myKey"</span><span class="p">,</span> <span class="s">"myValue"</span><span class="p">)</span>
</code></pre>
<p>Creates a field.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key</td>
</tr>
<tr>
<td>value</td>
<td>The value to set the key</td>
</tr>
</tbody></table>
<h3 id='returns-9'>Returns</h3>
<p><code>True</code> if successful, <code>False</code> otherwise.</p>
<h2 id='read-key-2'>read(key)</h2><pre class="highlight python tab-python"><code><span class="n">b</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">'myKey'</span><span class="p">);</span>
</code></pre>
<p>Retrieve the value of a key.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The key to retrieve.</td>
</tr>
</tbody></table>
<h3 id='returns-10'>Returns</h3>
<p>The value of the key, <code>None</code> otherwise.</p>
<h2 id='update-key-value-2'>update(key, value)</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">b</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">'myKey'</span><span class="p">,</span> <span class="s1">'myNewValue'</span><span class="p">)</span>
</code></pre>
<p>Updates a value in the database.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key to query</td>
</tr>
<tr>
<td>value</td>
<td>The value to set the key</td>
</tr>
</tbody></table>
<h3 id='returns-11'>Returns</h3>
<p><code>True</code> if successful, <code>False</code> otherwise.</p>
<h2 id='delete-key'>delete(key)</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">b</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'myKey'</span><span class="p">)</span>
</code></pre>
<p>Deletes a field from the database.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key to delete.</td>
</tr>
</tbody></table>
<h3 id='returns-12'>Returns</h3>
<p><code>True</code> if successful, <code>False</code> otherwise.</p>
<h2 id='has-key-2'>has(key)</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">b</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">'myKey'</span><span class="p">)</span>
</code></pre>
<p>Query to see if a key is in the database.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>The name of the key to query</td>
</tr>
</tbody></table>
<h3 id='returns-13'>Returns</h3>
<p><code>True</code> if they key is in the database, <code>False</code> otherwise.</p>
<h2 id='keys-2'>keys()</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">b</span><span class="p">.</span><span class="nx">keys</span><span class="p">()</span>
</code></pre>
<p>Retrieve a list of all keys.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
</tbody></table>
<h3 id='returns-14'>Returns</h3>
<p>A list of keys in the database.</p>
<h1 id='solidity-api'>Solidity API</h1>
<p>This section documents Bluzelle-Ethereum integration, provided as a Solidity file that implements a wrapper around Oraclize.</p>

<p>See also our <a href="https://github.com/bluzelle/eth-oracle">repository</a> on GitHub.</p>
<h2 id='importing'>Importing</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="s2">"https://github.com/bluzelle/eth-oracle/bluzelle.sol"</span><span class="p">;</span>
</code></pre>
<p>To use Bluzelle in a solidity contract, first import bluzelle.sol. If you are using remix, you can do this directly with the sample on the right.</p>

<p>If you are using an environment which doesn&#39;t handle that for you, you may have to download bluzelle.sol directly as well as its dependancies (<a href="https://github.com/oraclize/ethereum-api/blob/master/oraclizeAPI_0.4.sol">1</a> <a href="https://github.com/Arachnid/solidity-stringutils/blob/master/src/strings.sol">2</a>).</p>
<h2 id='usage'>Usage</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">contract</span> <span class="nx">MyContract</span> <span class="nx">is</span> <span class="nx">BluzelleClient</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<p>To use the Bluzelle interface, first have your contract extend BluzelleClient.</p>

<p>Call <code>setUUID(string, uuid)</code> before making any DB calls - this configures which distinct database you connect to. Your UUID should conform to UUIDv4, such as that found <a href="https://www.uuidgenerator.net/version4">here</a>.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">create</span><span class="p">(</span><span class="s2">"myKey"</span><span class="p">,</span> <span class="s2">"myValue"</span><span class="p">);</span>
<span class="nx">read</span><span class="p">(</span><span class="s2">"myKey"</span><span class="p">);</span>
<span class="nx">update</span><span class="p">(</span><span class="s2">"myKey"</span><span class="p">,</span> <span class="s2">"myNewValue"</span><span class="p">);</span>
<span class="nx">remove</span><span class="p">(</span><span class="s2">"myKey"</span><span class="p">);</span>
</code></pre>
<p>Then, DB operations are performed with these methods.</p>

<p>Each DB operation will consume a small amount of ether to pay Oraclize&#39;s fee.</p>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// When a read succeeds</span>
<span class="kd">function</span> <span class="nx">readResult</span><span class="p">(</span><span class="nx">string</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">string</span> <span class="nx">result</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// When a read fails</span>
<span class="kd">function</span> <span class="nx">readFailure</span><span class="p">(</span><span class="nx">string</span> <span class="nx">key</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{...}</span>

<span class="c1">// When a create, update, remove is performed</span>
<span class="kd">function</span> <span class="nx">createResponse</span><span class="p">(</span><span class="nx">string</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">success</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{...}</span>
<span class="kd">function</span> <span class="nx">updateResponse</span><span class="p">(</span><span class="nx">string</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">success</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{...}</span>
<span class="kd">function</span> <span class="nx">removeResponse</span><span class="p">(</span><span class="nx">string</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">success</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{...}</span>
</code></pre>
<p>All database operations are performed asynchronously (this is a fundamental constraint of running in Ethereum). If you want to act on the result of your database operations (and presumably you do, at least for reads), then override some or all of the callback methods.</p>
<h2 id='caveats'>Caveats</h2>
<p>This should work on any network Oraclize supports: Ropsten, Kovan, and Rinkeby as well as the main net. We do not recommend it for use on the main net; it&#39;s not known to be reliable or secure enough.</p>

<p>Each database transaction requires a small fee for Oraclize ($0.01 usd worth), and the transaction will fail if the contract balance is too low.</p>

<p>If you neglect to set a UUID before making a DB call, you will end up using the emptry string as your UUID. This may result in Bad Things.</p>
<h2 id='sample-application-2'>Sample Application</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">20</span><span class="p">;</span>

<span class="kr">import</span> <span class="s2">"https://github.com/bluzelle/eth-oracle/bluzelle.sol"</span><span class="p">;</span>

<span class="cm">/* This is a minimal sample client that watches the value of a single key in
 * Bluzelle */</span>
<span class="nx">contract</span> <span class="nx">SampleClient</span> <span class="nx">is</span> <span class="nx">BluzelleClient</span> <span class="p">{</span>

    <span class="nx">string</span> <span class="kr">public</span> <span class="nx">key</span><span class="p">;</span>
    <span class="nx">string</span> <span class="kr">public</span> <span class="nx">value</span><span class="p">;</span>

    <span class="nx">bool</span> <span class="kr">public</span> <span class="nx">keyExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">address</span> <span class="kr">private</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">SampleClient</span><span class="p">(</span><span class="nx">string</span> <span class="nx">_key</span><span class="p">,</span> <span class="nx">string</span> <span class="nx">_uuid</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">bytes</span><span class="p">(</span><span class="nx">_key</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">bytes</span><span class="p">(</span><span class="nx">_uuid</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nx">_key</span><span class="p">;</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">setUUID</span><span class="p">(</span><span class="nx">_uuid</span><span class="p">);</span>
        <span class="nx">create</span><span class="p">(</span><span class="nx">_key</span><span class="p">,</span> <span class="s2">"initial value"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Read the value from Bluzelle 
    (this requires a small fee to pay Oraclize) */</span>
    <span class="kd">function</span> <span class="nx">update</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span>
        <span class="nx">read</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Set the value */</span>
    <span class="kd">function</span> <span class="nx">set</span><span class="p">(</span><span class="nx">string</span> <span class="nx">_value</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span>
        <span class="nx">update</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">_value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* callback invoked by bluzelle upon read */</span>
    <span class="kd">function</span> <span class="nx">readResult</span><span class="p">(</span><span class="nx">string</span> <span class="cm">/*unused*/</span><span class="p">,</span> <span class="nx">string</span> <span class="nx">v</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* callback invoked by bluzelle upon create */</span>
    <span class="kd">function</span> <span class="nx">createResponse</span><span class="p">(</span><span class="nx">string</span> <span class="cm">/*unused*/</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">success</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">success</span><span class="p">){</span>
            <span class="nx">keyExists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/* callback invoked by bluzelle upon delete */</span>
    <span class="kd">function</span> <span class="nx">removeResponse</span><span class="p">(</span><span class="nx">string</span> <span class="cm">/*unusued*/</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">success</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">success</span><span class="p">){</span>
            <span class="nx">keyExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">refund</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span>
        <span class="nx">remove</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="nx">owner</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre><h1 id='websocket-api'>WebSocket API</h1>
<p>The <em>Bluzelle</em> architecture consists of a request-response system through WebSockets.</p>

<blockquote>
<p>WebSocket database messages are JSON strings with embedded base64-encoded serial data.</p>
</blockquote>
<pre class="highlight json-doc tab-json-doc"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"bzn-api"</span><span class="p">:</span><span class="w"> </span><span class="s2">"database"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>The JSON is considered static except for the value of the &quot;msg&quot; field, which may vary.</p>
</blockquote>

<p>Database requests are <a href="https://github.com/google/protobuf">protobuf</a> serial output embedded in JSON. The master database protofile is given <a href="https://github.com/bluzelle/swarmDB/blob/devel/proto/database.proto">here</a>. The protobuf message type for requests is <code>database_msg</code>.</p>

<p>Database responses are direct serial output through WebSocket. The protobuf message type for responses is <code>database_response</code>.</p>
<h2 id='steps-to-send-a-request-and-recieve-a-response'>Steps to send a request and recieve a response</h2>
<ol>
<li>Generate a <code>database_msg</code> object as specified in <a href="https://github.com/bluzelle/swarmDB/blob/devel/proto/database.proto">database.proto</a>.</li>
<li>Serialize the message.</li>
<li>Convert the serial data to a base64 string.</li>
<li>Embed the base64 string into <code>&quot;{ &quot;bzn-api&quot;: &quot;database&quot;, &quot;msg&quot;: &quot;YOUR STRING HERE&quot; }&quot;</code>.</li>
<li>Establish a WebSocket connection to a Bluzelle node and send the message as a string.</li>
<li>The response, coming as raw bytes, should be interpreted as a <code>database_response</code>.<br></li>
</ol>
<h2 id='example-messages-with-bluzelle-js'>Example messages with <code>bluzelle-js</code></h2><pre class="highlight plaintext"><code>// uuid: '8078e15c-ac47-4db9-83df-da6dba71231a'

bluzelle.create('hello', 'world');

{
    "bzn-api":"database",
    "msg":"Uj0SKAokODA3OGUxNWMtYWM0Ny00ZGI5LTgzZGYtZGE2ZGJhNzEyMzFhEARSERIFaGVsbG8aCAEid29ybGQi"
}



bluzelle.read('myKey');

{
    "bzn-api":"database",
    "msg":"UjMSKAokODA3OGUxNWMtYWM0Ny00ZGI5LTgzZGYtZGE2ZGJhNzEyMzFhEAZaBxIFbXlLZXk="
}



bluzelle.remove('hello');

{
    "bzn-api":"database",
    "msg":"UjMSKAokODA3OGUxNWMtYWM0Ny00ZGI5LTgzZGYtZGE2ZGJhNzEyMzFhEAdqBxIFaGVsbG8="
}



bluzelle.has('abcd');

{
    "bzn-api":"database",
    "msg":"UjISKAokODA3OGUxNWMtYWM0Ny00ZGI5LTgzZGYtZGE2ZGJhNzEyMzFhEAlyBhIEYWJjZA=="
}


</code></pre>
      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
